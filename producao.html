<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üß∞ Produ√ß√£o - Sistema de Pedidos</title>
  <style>
    :root {
      --bg: #f3f6fa;
      --card: #fff;
      --accent: #0b63d6;
      --muted: #556;
    }

    body {
      font-family: Inter, Segoe UI, Roboto, Arial, sans-serif;
      background: var(--bg);
      margin: 0;
      padding: 18px;
      color: #062436;
    }

    .container {
      max-width: 950px;
      margin: 0 auto;
    }

    h1 {
      font-size: 22px;
      margin-bottom: 14px;
      text-align: center;
      color: var(--accent);
    }

    form .row {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
    }

    input, textarea {
      padding: 10px;
      border: 1px solid #d6dde6;
      border-radius: 8px;
      font-size: 15px;
      width: 100%;
      box-sizing: border-box;
    }

    textarea { resize: vertical; }

    button {
      padding: 10px 16px;
      border: none;
      border-radius: 8px;
      font-size: 15px;
      cursor: pointer;
    }

    .btn-enviar { background: var(--accent); color: #fff; }
    .btn-limpar { background: #e6ebf0; color: #062436; }
    .btn-enviar:hover, .btn-limpar:hover { opacity: 0.9; }

    .list { margin-top: 12px; }

    .item {
      border: 1px solid #eef4fb;
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 10px;
      background: var(--card);
    }

    .meta {
      font-size: 13px;
      color: var(--muted);
    }

    .enviado {
      color: green;
      font-weight: bold;
    }

    footer {
      margin-top: 16px;
      font-size: 13px;
      color: var(--muted);
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üß∞ Produ√ß√£o - Sistema de Pedidos</h1>

    <!-- Formul√°rio -->
    <form id="formPedido">
      <div class="row">
        <input id="encarregada" placeholder="üë©‚Äçüè≠ Nome da encarregada (obrigat√≥rio)" required />
        <input id="peca" placeholder="üß© Nome da pe√ßa (obrigat√≥rio)" required />
      </div>
      <div class="row">
        <input id="referencia" placeholder="üìå Refer√™ncia (obrigat√≥rio)" required />
      </div>
      <div class="row">
        <textarea id="observacao" placeholder="üìù Observa√ß√£o (opcional)" rows="2"></textarea>
      </div>
      <div class="row">
        <button class="btn-enviar" type="submit">üì® Enviar pedido</button>
        <button class="btn-limpar" type="button" id="btnLimpar">üßº Limpar</button>
      </div>
    </form>

    <!-- Lista de pedidos -->
    <section class="list" id="listaPedidos"></section>

    <footer>
      Sistema integrado com Firebase Realtime Database.
    </footer>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { getDatabase, ref, push, onChildAdded, onChildChanged } 
      from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyClTCnRK2dT65VXjmriSrASdJqjmTUVgOs",
      authDomain: "sistema-de-pedidos-208dd.firebaseapp.com",
      databaseURL: "https://sistema-de-pedidos-208dd-default-rtdb.firebaseio.com",
      projectId: "sistema-de-pedidos-208dd",
      storageBucket: "sistema-de-pedidos-208dd.firebasestorage.app",
      messagingSenderId: "728239911093",
      appId: "1:728239911093:web:fdb33f1ea4a4d314738efc"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const pedidosRef = ref(db, "pedidos");

    const form = document.getElementById("formPedido");
    const lista = document.getElementById("listaPedidos");
    const btnLimpar = document.getElementById("btnLimpar");

    function renderPedido(id, pedido) {
      const div = document.createElement("div");
      div.className = "item";
      div.id = "i-" + id;

      let html = `<div>
        <div style="font-weight:700">${pedido.peca}</div>
        <div class="meta">üë©‚Äçüè≠ ${pedido.encarregada}</div>
        <div class="meta">üìå Ref: ${pedido.referencia}</div>
        <div class="meta">üïí Criado em: ${new Date(pedido.createdAt).toLocaleString("pt-BR")}</div>
        ${pedido.observacao ? `<div class="meta">üìù ${pedido.observacao}</div>` : ""}
        ${pedido.enviado && pedido.dataEnvio ? `<div class="meta enviado">‚úÖ Enviado em: ${new Date(pedido.dataEnvio).toLocaleString("pt-BR")}</div>` : ""}
      </div>`;

      div.innerHTML = html;
      return div;
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const encarregada = document.getElementById("encarregada").value.trim();
      const peca = document.getElementById("peca").value.trim();
      const referencia = document.getElementById("referencia").value.trim();
      const observacao = document.getElementById("observacao").value.trim();

      if (!encarregada || !peca || !referencia) {
        alert("‚ö†Ô∏è Preencha todos os campos obrigat√≥rios.");
        return;
      }

      await push(pedidosRef, {
        encarregada,
        peca,
        referencia,
        observacao,
        createdAt: Date.now(),
        enviado: false
      });

      form.reset();
      document.getElementById("encarregada").focus();
    });

    btnLimpar.addEventListener("click", () => {
      form.reset();
      document.getElementById("encarregada").focus();
    });

    onChildAdded(pedidosRef, (snap) => {
      const pedido = snap.val();
      const id = snap.key;
      if (!document.getElementById("i-" + id)) lista.prepend(renderPedido(id, pedido));
    });

    onChildChanged(pedidosRef, (snap) => {
      const pedido = snap.val();
      const id = snap.key;
      const el = document.getElementById("i-" + id);
      if (el) el.replaceWith(renderPedido(id, pedido));
    });
  </script>
</body>
</html>
